@c -*- coding: utf-8; mode: texinfo; documentlanguage: es -*-

@ignore
    Translation of GIT committish: af3c4ca42e348ec53b5034c50f3eeb435f7db05e

    When revising a translation, copy the HEAD committish of the
    version that you are working on.  For details, see the Contributors'
    Guide, node Updating translation committishes..
@end ignore

@c \version "2.13.36"

@node Problemas de espaciado
@chapter Problemas de espaciado
@translationof Spacing issues

La disposición global sobre el papel viene determinada por tres
factores: el diseño de página, los saltos de línea y el espaciado.
Estos factores influyen entre sí.  La elección de uno u otro espaciado
determina qué densidad termina teniendo cada sistema de música.  Esto
influye en el lugar en que se eligen los saltos de línea y, en último
término, en el número de páginas que tiene una partitura.

Considerado globalmente, este proceso se produce en cuatro fases: en
primer lugar se eligen unas distancias elásticas o @q{muelles},
basados en la duración de las figuras.  Se prueban todas las
combinaciones de saltos de línea posibles, y para cada una de ellas se
calcula una puntuación de @q{maldad}.  Después se hace una estimación
de la altura de cada uno de los posibles sistemas.  Finalmente se
selecciona una combinación de saltos de página y de línea de tal forma
que ni el espaciado horizontal ni el vertical estén demasiado
estrechos ni estirados.

Los ajustes que influyen en la disposición se pueden agrupar en dos
bloques.  El bloque @code{\paper @{...@}} se sitúa fuera de los
bloques @code{\score @{...@}} y contiene ajustes relacionados con el
documento como un todo.  El bloque @code{\layout @{...@}} se sitúa
dentro de un bloque @code{\score @{...@}} y contiene ajustes para
dicha partitura en concreto.  Si sólo tiene un bloque @code{\score
@{...@}}, los dos tienen el mismo efecto.  En general las
instrucciones que se muestran en este capítulo se pueden poner en
cualquiera de los dos.

@menu
* El papel y las páginas::
* Disposición de la música::
* Saltos::
* Espaciado vertical::
* Espaciado horizontal::
* Encajar la música en menos páginas::
@end menu


@node El papel y las páginas
@section El papel y las páginas
@translationof Paper and pages

Esta sección se ocupa de los límites que definen la zona del papel en
que se puede imprimir la música.

@menu
* Tamaño del papel::
* Formateo de las páginas::
@end menu


@node Tamaño del papel
@subsection Tamaño del papel
@translationof Paper size

@cindex papel, tamaño del
@cindex página, tamaño de la

Existen dos funciones para cambiar el tamaño del papel:
@code{set-default-paper-size} (establecer tamaño de página
predeterminado) y @code{set-paper-size} (establecer tamaño de página).
@code{set-default-paper-size} se debe poner en el ámbito del nivel
superior, y @code{set-paper-size} se debe poner en un bloque
@code{\paper}:

@example
#(set-default-paper-size "a4")
@end example

@example
\paper @{
  #(set-paper-size "a4")
@}
@end example

@noindent
@code{set-default-paper-size} establece el tamaño de todas las
páginas, mientras que @code{set-paper-size} establece sólo el tamaño
de las páginas a las que se aplica el bloque @code{\paper}.  Por
ejemplo, si el bloque @code{\paper} está al principio del archivo,
aplica el tamaño de papel a todas las páginas.  Si el bloque
@code{\paper} está dentro de un bloque @code{\book}, entonces el
tamaño del papel sólo se aplica a ese libro.

Se encuentran disponibles los tamaños de papel más comunes, entre
ellos @code{a4}, @code{letter}, @code{legal} y @code{11x17} (conocido
también como tabloide). Están contemplados muchos más tamaños de papel
de forma predeterminada.  Para ver más detalles, consulte
@file{scm/@/paper@/.scm} y busque la definición de @code{paper-alist}.

@c TODO add a new appendix for paper sizes (auto-generated) -pm

@warning{El tamaño predeterminado del papel es @code{a4}.}

Se pueden añadir tamaños adicionales editando la definición de
@code{paper-alist} en el archivo de inicio @file{scm/@/paper@/.scm},
aunque se sobreescribirán en la siguiente reinstalación del programa.

@cindex orientación
@cindex apaisado
@cindex horizontal, papel

Si se añade el símbolo @code{'landscape} (apaisado) como argumento a
@code{set-default-paper-size}, las páginas se giran 90 grados y se
establece en consonancia una mayor longitud de las líneas.

@example
#(set-default-paper-size "a6" 'landscape)
@end example

Al establecer el tamaño del papel se ajustan un cierto número de
variables del @code{\paper}, tales como los márgenes.  Para utilizar
un tamaño de página determinado con variables de @code{\paper}
alteradas, establezca el tamaño de página antes de dar valores a las
variables.


@seealso
Archivos instalados:
@file{scm/@/paper@/.scm}.

Fragmentos de código:
@rlsr{Spacing}.


@node Formateo de las páginas
@subsection Formateo de las páginas
@translationof Page formatting

Los márgenes, encabezamientos y pies de página y otras variables de
diseño de página se establecen automáticamente de acuerdo con el
tamaño del papel.

El valor predeterminado de los márgenes está accesible en el archivo
@file{ly/@/paper@/-defaults@/-init@/.ly}.  Estos valores se aplican al
tamaño predeterminado del papel (A4, a no ser que se especifique de
otra forma) y se escalan adecuadamente para otros tamaños del papel.

Esta sección relaciona y describe cierto número de variables del papel
que se pueden alterar.

@menu
* Dimensiones verticales::
* Dimensiones horizontales::
* Otras variables de diseño de página::
@end menu


@node Dimensiones verticales
@unnumberedsubsubsec Dimensiones verticales
@translationof Vertical dimensions

Estas variables se utilizan para establecer las diferentes dimensiones
verticales de la página:

@funindex \paper

@table @code

@item markup-system-spacing
@funindex markup-system-spacing

Especifica cómo calcular el espacio entre un título (o un elemento de
marcado del nivel superior) y el sistema que le sigue.  Es una lista
asociativa con cinco componentes:
@itemize @bullet
@item @var{space}:
cantidad de espacio que puede ensancharse entre la línea base de un
título y el centro del pentagrama que le sigue;
@item @var{padding}:
cantidad mínima de espacio vacío que se debe dejar entre un título y
el pentagrama que le sigue;
@item @var{stretchability}:
facilidad con que el espacio ensanchable aumenta cuando se estira una
página.  Si es cero, la distancia al pentagrama siguiente no se
ensancha en absoluto;
@item @var{minimum-distance}:
distancia mínima que poner entre la línea de base de un título y el
centro del pentagrama que le sigue. Se diferencia de @var{padding} en
que la altura de un pentagrama no tiene ningún efecto sobre la
aplicación de @var{minimum-distance} (mientras que la altura del
pentagrama es crucial para @var{padding}).
@end itemize

Por ejemplo, los valores predeterminados son:

@example
markup-system-spacing = #'((space . 2) (padding . 0.5))
@end example


Si una página tiene la parte de abajo no ajustada, @var{space} no se
ensancha.  Concretamente, la distancia que resulta sobre esta página
es la mayor de
@itemize @bullet
@item @var{space},
@item @var{minimum-distance}, y
@item @var{padding} más la menor distancia necesaria para eliminar la superposición.
@end itemize

@item score-markup-spacing
@funindex score-markup-spacing

Especifica el espacio entre un sistema y el título (o elemento de
marcado del nivel superior) que le sigue.  Las distancias se miden a
partir del centro del último pentagrama del sistema hasta la línea de
base del título que le sigue.  Véase @var{markup-system-spacing}.

@item score-system-spacing
@funindex score-system-spacing

Especifica el espacio entre dos sistemas si están en diferentes
partituras, pero no hay ningún título entre ellas. Véase
@var{markup-system-spacing}.

@item system-system-spacing
@funindex system-system-spacing

Especifica el espacio entre el centro del pentagrama inferior de un
sistema y el centro del pentagrama superior del sistema siguiente.
Véase @var{markup-system-spacing}.

@item markup-markup-spacing
@funindex markup-markup-spacing

Especifica el espacio entre dos títulos (o elementos de marcado del
nivel superior).  Las distancias se miden a partir de la línea de base
de del primer título hasta la línea de base del segundo.  Véase
@var{markup-system-spacing}.

@item bottom-margin
@funindex bottom-margin

Margen entre el pie y el final de la página.  Valor predeterminado:
@code{6\mm}.

@item last-bottom-spacing
@funindex last-bottom-spacing

Especifica el espacio desde el centro del último pentagrama (o la
línea de base del último elemento de marcado del nivel superior) hasta
el final del área imprimible (es decir, el límite superior del margen
inferior).  Véase @var{markup-system-spacing}.

@item top-markup-spacing
@funindex top-markup-spacing

Especifica el espacio desde el principio del área imprimible (es
decir, el límite inferior del margen superior) hasta la línea de base
del título.  Véase @var{markup-system-spacing}.

@item top-system-spacing
@funindex top-system-spacing

Especifica el espacio desde el principio del área imprimible (es
decir, el límite inferior del margen superior) hasta el centro del
primer pentagrama.  Sólo tiene efecto si no hay ningún título al
principio de la página (en cuyo caso se utiliza en su lugar
@var{top-markup-spacing}).  Véase @var{markup-system-spacing}.

@item paper-height
@funindex paper-height

Altura de la página.  Predeterminado: altura del tamaño actual del
papel.  Para ver más detalles, consulte @ref{Tamaño del papel}.

@item top-margin
@funindex top-margin

Margen entre el encabezamiento y la parte alta del papel.
Predeterminado: @code{5\mm}.

@end table


@snippets

El encabezamiento y el pie se crean por parte de las funciones
@code{make-footer} y @code{make-header}, definidas dentro de
@code{\paper}.  Las implementaciones predeterminadas están en
@file{ly/paper-defaults.ly} y en @file{ly/titling-init.ly}.

El diseño de la página en sí está realizado por dos funciones dentro
del bloque @code{\paper}, @code{page-music-height} y
@code{page-make-stencil}.  El primero informa al algoritmo de saltos
de línea de la cantidad de espacio que está disponible en una página,
y el último crea la propia página dado el sistema que poner sobre
ella.

Se pueden definir valores del bloque @code{\paper} en Scheme.  En tal
caso, @code{mm}, @code{in}, @code{pt}, y @code{cm} son variables que
están definidas en @file{paper-defaults.ly} con valores en milímetros.
Por ello el valor 2 cm se debe multiplicar en el siguiente ejemplo:

@example
\paper @{
 #(define bottom-margin (* 2 cm))
@}
@end example


Ejemplo:

@example
\paper @{
  paper-width = 2\cm
  top-margin = 3\cm
  bottom-margin = 3\cm
  ragged-last-bottom = ##t
@}
@end example

Este segundo ejemplo centra los números de página en la parte baja del
papel.

@example
\paper @{
  print-page-number = ##t
  print-first-page-number = ##t
  oddHeaderMarkup = \markup \fill-line @{ " " @}
  evenHeaderMarkup = \markup \fill-line @{ " " @}
  oddFooterMarkup = \markup @{ \fill-line @{
     \bold \fontsize #3 \on-the-fly #print-page-number-check-first
     \fromproperty #'page:page-number-string @} @}
  evenFooterMarkup = \markup @{ \fill-line @{
     \bold \fontsize #3 \on-the-fly #print-page-number-check-first
     \fromproperty #'page:page-number-string @} @}
@}
@end example

También podemos definir estos valores en Scheme.  En tal caso,
@code{mm}, @code{in}, @code{pt} y @code{cm} son variables definidas en
@file{paper@/-defaults@/-init@/.ly} con valores en milímetros.  Es la
razón por la que el valor se debe multiplicar en el ejemplo

@example
\paper @{
  #(define bottom-margin (* 2 cm))
@}
@end example

El encabezamiento y el pie se crean por parte de las funciones
@code{make-footer} y @code{make-header}, definidas en @code{\paper}.
Las implementaciones predeterminadas están en
@file{ly/@/paper@/-defaults@/-init@/.ly} y en
@file{ly/@/titling@/-init@/.ly}.

La propia disposición de la página se realiza por parte de dos
funciones del bloque @code{\paper}, @code{page-music-height} y
@code{page-make-stencil}.  La primera dice al algoritmo de saltos de
línea cuánto espacio se puede emplear en la página, y la segunda crea
la página en sí dado el sistema que poner en ella.


@seealso
Referencia de la notación:
@ref{Espaciado vertical entre sistemas}.

Fragmentos de código:
@rlsr{Spacing}.


@node Dimensiones horizontales
@unnumberedsubsubsec Dimensiones horizontales
@translationof Horizontal dimensions


Existe un cierto número de variables que determinan las dimensiones
horizontales de una página:

@table @code

@item binding-offset
@funindex binding-offset

Se aumenta la cantidad @code{inner-margin} para asegurar que el
encuadernado no va a tapar nada.  Sólo funciona con @code{two-sided}
establecido al valor verdadero.  Valor predeterminado: @code{0}.

@item horizontal-shift
@funindex horizontal-shift

Medida en que todos los sistemas (incluidos los títulos de cabecera y
los separadores de sistemas) se desplazan a la derecha.
Predeterminado: @code{0.0}.

@item indent
@funindex indent

Nivel de sangrado para el primer sistema de una partitura.  Valor
predeterminado: @code{15\mm}.

@item inner-margin
@funindex inner-margin

Margen que tienen todas las páginas en el lado interior si son parte
de un libro.  Sólo funciona con @code{two-sided} establecido al valor
verdadero.  Valor predeterminado: @code{10\mm}.

@item left-margin
@funindex left-margin

El margen entre el límite izquierdo del papel y el comienzo de los
sistemas.  Predeterminado: @code{10\mm}.

@item line-width
@funindex line-width

Ancho de los sistemas.  Predeterminado: @code{paper-width} menos
@code{left-margin} y @code{right-margin}.

@item outer-margin
@funindex outer-margin

Margen que todas las páginas tienen en la parte exterior si son parte
de un libro.  Sólo funciona con @code{two-sided} establecido al valor
verdadero.  Valor predeterminado: @code{20\mm}.

@item paper-width
@funindex paper-width

Ancho de la página.  Predeterminado: la anchura del tamaño actual del
papel.  Para ver más detalles, consulte @ref{Tamaño del papel}.

@item right-margin
@funindex right-margin

Margen entre el borde derecho de la página y el final de cada sistema.
Valor predeterminado: @code{10\mm}.

@item short-indent
@funindex short-indent

Nivel de sangrado para todos los sistemas de una partitura excepto el
primero.  Predeterminado: @code{0}.

@end table

Si hay valores sin ajustar, se toman los predeterminados.  Se ajusta
su valor exacto, dependiendo del tamaño de papel especificado.  Por el
momento, los siguientes valores se ven afectados por este escalado:

@itemize
@item @var{left-margin}
@item @var{right-margin}
@item @var{top-margin}
@item @var{bottom-margin}
@item @var{head-separation}
@item @var{foot-separation}
@item @var{indent}
@item @var{short-indent}
@end itemize

Los ajustes para @code{line-width}, @code{left-margin},
@code{right-margin} y @code{paper-width} dependen entre sí, pero no
tienen que especificarse completamente.

@example
\paper @{
  left-margin = 30\mm
@}
@end example

En este ejemplo, sólo se establece un valor para @code{left-margin}.
El valor de @code{right-margin} sigue siendo el predeterminado,
@code{line-width} se calcula automáticamente.

@example
\paper @{
  line-width = 150\mm
@}
@end example

Aquí @code{left-margin} y @code{right-margin} se ajustan al mismo
valor.  Por tanto, @code{line-width} se sustrae de @code{paper-width}
y se divide entre dos.  Esto significa que los sistemas se imprimen
centrados en la página, si sólo se especifica @code{line-width}.

Tienen lugar algunas comprobaciones para asegurar que los valores se
establecen correctamente.  Si los valores no encajasen o los sistemas
se fueran a salir de la página, se imprime una advertencia y se
establecen los valores predeterminados.

@example
\paper @{
  paper-width = 210\mm
  left-margin = 20\mm
  right-margin = 30\mm
  line-width = 100\mm
@}
@end example

Estas comprobaciones se pueden evitar estableciendo
@code{check-consistency} al valor falso.

@example
\paper @{
  paper-width = 210\mm
  left-margin = 20\mm
  line-width = 200\mm
  check-consistency = ##f
@}
@end example

@warning{Si @code{paper-width} se ajusta manualmente,
@code{line-width}, @code{left-margin}, @code{indent} y
@code{short-indent} podrían tener que ajustarse también.}

@seealso
Fragmentos de código:
@rlsr{Spacing}.



@node Otras variables de diseño de página
@unnumberedsubsubsec Otras variables de diseño de página
@translationof Other layout variables

Estas variables se pueden usar para ajustar el diseño de la página en
general.

@table @code

@item auto-first-page-number
@funindex auto-first-page-number

El algoritmo de división de páginas está afectado por el hecho de que
el número de la primera página sea par o impar.  Si está establecido
al valor verdadero, el algoritmo de división de páginas decide si
comenzar con un número par o impar.  Esto hace que el número de la
primera página se quede como está, o que se aumente en una unidad.
Predeterminado: @code{##f}.

@ignore

FIXME: this variable is used, but I don't know what it does. -pm
@item blank-after-score-page-force
@funindex blank-after-score-page-force

Default: @code{2}.

@end ignore

@item blank-last-page-force
@funindex blank-last-page-force

Penalización por terminar la partitura en una página de numeración
impar.  Predeterminado: @code{0}.

@item blank-page-force
@funindex blank-page-force

Penalización por tener una página en blanco en medio de una partitura.
Esto no se usa por parte de @code{ly:optimal-breaking} porque éste
nunca considera la posibilidad de tener páginas en blanco en mitad de
una partitura.  Predeterminado: @code{5}.

@item check-consistency
@funindex check-consistency

Si es verdadero, comprobar si @code{left-margin}, @code{right-margin}
y @code{line-width} encajan entre sí.  También asegurar que su
combinación no excede del @code{paper-width} disponible.  Valor
predeterminado: @code{##t}.

@item first-page-number
@funindex first-page-number

Valor del número de la primera página.  Predeterminado: @code{#1}.

@item max-systems-per-page
@funindex max-systems-per-page

Máximo número de sistemas que tendrán cabida en una página.  Está
contemplado por el momento solamente por parte del algoritmo
@code{ly:optimal-breaking}.  Predeterminado: no establecido.

@item min-systems-per-page
@funindex min-systems-per-page

Mínimo número de sistemas que habrá en una página.  Puede hacer que
las páginas se llenen en exceso si se establece a un valor grande.
Por el momento solamente está contemplado por parte del algoritmo
@code{ly:optimal-breaking}.  Predeterminado: no establecido.

@item page-breaking-system-system-spacing
@funindex page-breaking-system-system-spacing

Engaña al divisor de páginas para que crea que
@code{system-system-spacing} está establecido a algo distinto de lo
que está realmente.  Por ejemplo, si
@code{page-breaking-system-system-spacing #'padding} se establece a algo
mucho mayor que @code{system-system-spacing #'padding}, entonces
el divisor de páginas colocará menos sistemas en cada página.
Predeterminado: no establecido.

@item page-count
@funindex page-count

Número de páginas que usar para una partitura. Predeterminado: sin
fijar.

@item page-limit-inter-system-space
@funindex page-limit-inter-system-space

Si tiene un valor verdadero, limita el espacio entre los sistemas de
una página en la que sobra mucho espacio.  Predeterminado: @code{##f}.
Para ver más detalles, consulte @ref{Espaciado vertical entre sistemas}.

@item page-limit-inter-system-space-factor
@funindex page-limit-inter-system-space-factor

Factor usado por @code{page-limit-inter-system-space}.
Predeterminado: @code{1.4}.  Para ver más detalles, consulte
@ref{Espaciado vertical entre sistemas}.

@item page-spacing-weight
@funindex page-spacing-weight

Importancia relativa del espacio (vertical) de las páginas y el
espaciado (horizontal) de las líneas.  Los valores altos hacen que el
espaciado de la página tenga más importancia.  Predeterminado:
@code{#10}.

@item print-all-headers
@funindex print-all-headers

Si está establecido a un valor verdadero, imprime todas las cabeceras
para cada una de las @code{\score} en la salida impresa.  Normalmente
sólo se imprimen las variables de encabezamiento de pieza y opus.
Predeterminado: @code{##f}.

@item print-first-page-number
@funindex print-first-page-number

Si está establecido a un valor verdadero, se imprime un número de
página en la primera página.  Predeterminado: @code{##f}.

@item print-page-number
@funindex print-page-number

Si está establecido a un valor falso, no se imprimen los números de
página.  Predeterminado: @code{##t}.

@item ragged-bottom
@funindex ragged-bottom

Si está establecido a un valor verdadero, los sistemas no ocuparán
verticalmente toda la altura de la página.  Esto no afecta a la última
página.  Predeterminado: @code{##f}.

Esto se debería establecer al valor verdadero para piezas que tienen
sólo dos o tres sistemas por página, por ejemplo partituras
orquestales.

@item ragged-last
@funindex ragged-last

Si está establecido a un valor verdadero, el último sistema de la
partitura no llenará la anchura de la línea.  En su lugar, el último
sistema termina en su longitud horizontal natural.  Predeterminado:
@code{##f}.

@item ragged-last-bottom
@funindex ragged-last-bottom

Si está establecido a un valor falso, los sistemas se repartirán
verticalmente por toda la última página.  Predeterminado: @code{##t}.

Las piezas que llenan generosamente dos o más páginas deberían tener
esto establecido al valor verdadero.

También afecta a la última página de las partes de libro, es decir,
partes de un libro que se han creado con bloques @code{\bookpart}.

@item ragged-right
@funindex ragged-right

Si está establecido a un valor verdadero, los sistemas no llenarán el
ancho de línea disponible.  En su lugar, los sistemas terminan en su
longitud horizontal natural.  Predeterminado: @code{##f}.

Si la partitura sólo tiene un sistema, el valor predeterminado es
@code{##t}.

@item system-separator-markup
@funindex system-separator-markup

Objeto de marcado que se inserta entre los sistemas.  Se suele usar
para partituras orquestales.  Predeterminado: sin establecer.

Se ofrece la instrucción de marcado @code{\slashSeparator} como un
valor predeterminado apropiado, por ejemplo

@lilypond[quote,ragged-right]
#(set-default-paper-size "a6" 'landscape)
\book {
  \score {
    \relative c' { c1 \break c1 }
  }
  \paper {
    system-separator-markup = \slashSeparator
  }
}
@end lilypond

@item system-count
@funindex system-count

Cantidad de sistemas que usar por parte de la partitura.
Predeterminado: sin establecer.

@item systems-per-page
@funindex systems-per-page

Número de sistemas que se deben colocar en cada página.  Está
contemplado solamente por parte del algoritmo
@code{ly:optimal-breaking} por el momento.  Predeterminado: no
establecido.

@item two-sided
@funindex two-sided

@cindex encuadernación
@cindex margen de encuadernación

Si es verdadero, usar @code{inner-margin}, @code{outer-margin} y
@code{binding-offset} para determinad los márgenes dependiendo de si
el número de página es par o impar.  Esto sobreescribe a
@code{left-margin} y a @code{right-margin}.  Valor predeterminado:
@code{##f}.

@end table


@seealso
Fragmentos de código:
@rlsr{Spacing}.


@knownissues

El encabezamiento de página predeterminado pone el número de página y
el campo @code{instrument} del bloque @code{\header} sobre la misma
línea.

Los títulos de cabecera (tomados de la sección @code{\header@{@}}) se
tratan como un sistema, por lo que @code{ragged-bottom} y
@code{ragged-last-bottom} añaden espacio entre los títulos y el primer
sistema de la partitura.


@node Disposición de la música
@section Disposición de la música
@translationof Music layout

@menu
* Establecer el tamaño del pentagrama::
* Disposición de la partitura::
@end menu


@node Establecer el tamaño del pentagrama
@subsection Establecer el tamaño del pentagrama
@translationof Setting the staff size

@cindex tipografía, establecer tamaño de
@cindex pentagrama, establecer tamaño de
@funindex layout file

El @strong{tamaño de pentagrama} predeterminado se establece en 20
puntos.  Esto se puede modificar de dos maneras:

Para establecer globalmente el tamaño del pentagrama para todas las
partituras de un archivo (o en un bloque @code{book}, para ser
exactos), utilice @code{set-global-staff-size}.

@example
#(set-global-staff-size 14)
@end example

@noindent
Esto establece el tamaño global predeterminado a una altura de
pentagrama de 14pt y escala todas las tipografías según corresponda.

Para establecer el tamaño del pentagrama de forma individual para cada
partitura, use
@example
\score@{
  ...
  \layout@{
  #(layout-set-staff-size 15)
  @}
@}
@end example

La fuente tipográfica Feta ofrece símbolos musicales a ocho tamaños
distintos.  Cada fuente tipográfica está afinada para un tamaño de
pentagrama distinto: a un tamaño menor la tipografía se vuelve más
pesada, para que coincida con las líneas de pentagrama relativamente
más gruesas.  Los tamaños de tipografía recomendados están
relacionados en la tabla siguiente:

@quotation
@multitable @columnfractions .15 .2 .22 .2

@item @b{nombre de la fuente}
@tab @b{altura del pentagrama (pt)}
@tab @b{altura del pentagrama (mm)}
@tab @b{usos}

@item feta11
@tab 11.22
@tab 3.9
@tab partituras de bolsillo

@item feta13
@tab 12.60
@tab 4.4
@tab

@item feta14
@tab 14.14
@tab 5.0
@tab

@item feta16
@tab 15.87
@tab 5.6
@tab

@item feta18
@tab 17.82
@tab 6.3
@tab cancioneros

@item feta20
@tab 20
@tab 7.0
@tab particellas estándar

@item feta23
@tab 22.45
@tab 7.9
@tab

@item feta26
@tab 25.2
@tab 8.9
@tab
@c modern rental material?

@end multitable
@end quotation

Estas tipografías están disponibles en cualquier tamaño.  La propiedad
de contexto @code{fontSize} y la propiedad de disposición
@code{staff-space} (en @rinternals{StaffSymbol}) se pueden usar para
afinar el tamaño de los pentagramas individuales.  Los tamaños de
pentagrama individuales están en relación al tamaño global.


@seealso
Referencia de la notación:
@ref{Seleccionar el tamaño de la tipografía para la notación}.

Fragmentos de código:
@rlsr{Spacing}.


@knownissues

@code{layout-set-staff-size} no cambia la distancia entre las líneas
del pentagrama.


@node Disposición de la partitura
@subsection Disposición de la partitura
@translationof Score layout

@funindex \layout

Mientras que @code{\paper} contiene ajustes relativos al formato de
página del documento completo, @code{\layout} contiene ajustes para la
disposición específica de cada partitura.

@example
\layout @{
  indent = 2.0\cm
  \context @{ \Staff
    \override VerticalAxisGroup #'minimum-Y-extent = #'(-6 . 6)
  @}
  \context @{ \Voice
    \override TextScript #'padding = #1.0
    \override Glissando #'thickness = #3
  @}
@}
@end example


@seealso
Referencia de la notación:
@ref{Cambiar los valores por omisión de los contextos}.

Fragmentos de código:
@rlsr{Spacing}.


@node Saltos
@section Saltos
@translationof Breaks

@menu
* Saltos de línea::
* Saltos de página::
* Saltos de página óptimos::
* Paso de página óptimo::
* Saltos de página mínimos::
* Saltos de línea explícitos::
* Utilizar una voz adicional para los saltos de línea::
@end menu


@node Saltos de línea
@subsection Saltos de línea
@translationof Line breaking

@cindex saltos de línea
@cindex línea, saltos de

Normalmente los saltos de línea se determinan automáticamente. Se
eligen de forma que las líneas no aparezcan demasiado apretadas ni
demasiado sueltas, y que las líneas consecutivas tengan una densidad
similar.  Ocasionalmente podemos querer sobreescribir los saltos
automáticos; podemos hacerlo especificando @code{\break}. Esto fuerza
un salto de línea en ese punto.  Sin embargo, los saltos de línea sólo
pueden suceder al final de los compases @q{completos}, es decir, donde
no queda ninguna nota o grupo especial @q{colgando} por encima de la
línea divisoria.  Si queremos poner un salto de línea donde no hay
línea divisoria, podemos forzar una barra de compás invisible
introduciendo @code{\bar ""}, aunque de nuevo no deben quedar notas
colgando en ninguno de los pentagramas en este punto, o se ignorarán.

La instrucción opuesta, @code{\noBreak}, prohíbe un salto de línea en
la barra divisoria en que se inserta.

Los ajustes más básicos que influyen sobre el espaciado de las líneas
son @code{indent} y @code{line-width}. Se establecen dentro del bloque
@code{\layout}.  Controlan el sangrado de la primera línea de música,
y la longitud de las líneas.

Si se establece @code{ragged-right} a verdadero en el bloque
@code{\layout}, los sistemas terminan en su longitud horizontal
natural, en lugar de distribuirse horizontalmente para llenar toda la
línea. Esto es de utilidad para fragmentos cortos, y para efectuar una
comprobación de lo apretado que es el espaciado natural.

@c TODO Check and add para on default for ragged-right

La opción @code{ragged-last} es similar a @code{ragged-right}, pero
afecta sólo a la última línea de la pieza.

@example
\layout @{
indent = #0
line-width = #150
ragged-last = ##t
@}
@end example



@cindex saltos de línea normales
@cindex música de cuatro compases por línea

Para saltos de línea a intervalos regulares utilice @code{\break}
separado mediante desplazamientos con @code{\skip} y repetidos con
@code{\repeat}.  Por ejemplo, esto haría que los 28 compases
siguientes (suponiendo un compás de 4/4) se dividan cada cuatro
compases, y sólo en dichos lugares:

@example
<< \repeat unfold 7 @{
         s1 \noBreak s1 \noBreak
         s1 \noBreak s1 \break @}
   @emph{the real music}
>>
@end example

@c TODO Check this
Una configuración de división de líneas se puede guardar como archivo
@code{.ly} automáticamente.  Ello permite que alineaciones verticales
se estiren para que encajen en las páginas durante una segunda
ejecución del proceso de formateo.  Esta posibilidad es bastante
novedosa y difícil.  Hay más detalles disponibles en @rlsr{Spacing}.


@predefined
@funindex \break
@code{\break},
@funindex \noBreak
@code{\noBreak}.
@endpredefined


@seealso
Referencia de funcionamiento interno:
@rinternals{LineBreakEvent}.

Fragmentos de código:
@rlsr{Spacing}.


@knownissues

Sólo pueden ocurrir saltos de línea si hay una @q{buena} línea
divisoria.  Una nota colgando de una línea divisoria no es adecuada,
como

@lilypond[quote,ragged-right,relative=2,fragment,verbatim]
c4 c2 << c2 {s4 \break } >>  % this does nothing
c2 c4 |           % a break here would work
c4 c2 c4 ~ \break % as does this break
c4 c2 c4
@end lilypond

Esto se puede evitar eliminando el grabador
@code{Forbid_line_break_engraver}.  Observe que los saltos de línea
forzados manualmente se tienen que añadir en paralelo con la música.

@lilypond[quote,ragged-right,verbatim]
\new Voice \with {
  \remove Forbid_line_break_engraver
} {
  c4 c2 << c2 {s4 \break } >>  % now the break is allowed
  c2 c4
}
@end lilypond

De forma parecida, los saltos de línea están prohibidos normalmente
cuando las barras cruzan a las líneas divisorias.  Este comportamiento
se puede modificar con el establecimiento de @code{\override Beam
#'breakable = ##t}.


@node Saltos de página
@subsection Saltos de página
@translationof Page breaking

Se puede sobreescribir el mecanismo predeterminado de salto de página
insertando instrucciones @code{\pageBreak} o @code{\noPageBreak}.
Estas instrucciones son análogas a @code{\break} y @code{\noBreak}.
Se deben insertar en una línea divisoria.  Estas instrucciones fuerzan
y prohíben, respectivamente, la eventualidad de un salto de página.
Por supuesto, la instrucción @code{\pageBreak} también fuerza un salto
de línea.

Las instrucciones @code{\pageBreak} y @code{\noPageBreak} también se
pueden insertar en el nivel más alto, entre las partituras y los
elementos de marcado situados en el nivel superior.

Hay ajustes análogos a @code{ragged-right} y @code{ragged-last} que
tienen el mismo efecto sobre el espaciado vertical:
@code{ragged-bottom} y @code{ragged-last-bottom}.  Si están
establecidos a @code{##t} los sistemas de todas las páginas o sólo de
la última página, respectivamente, no se verán justificados
verticalmente.

Para ver más detalles, consulte @ref{Espaciado vertical}.

Los saltos de página se calculan por medio de la función
@code{page-breaking}.  LilyPond ofrece tres algoritmos para el cómputo
de los saltos de página: @code{ly:optimal-breaking},
@code{ly:page-turn-breaking} y @code{ly:minimal-breaking}.  El
predeterminado es @code{ly:optimal-breaking}, pero el valor se puede
cambiar en el bloque @code{\paper}:

@example
\paper@{
  #(define page-breaking ly:page-turn-breaking)
@}
@end example

@funindex \bookpart

Cuando un libro tiene muchas partituras y páginas, puede ser difícil
resolver el problema de los saltos de página, necesitando mucha
memoria y prolongados tiempos de procesamiento.  Para facilitar el
proceso de división en páginas, se usan los bloques @code{\bookpart}
para dividir el libro en varias partes: los saltos de página se
producen de manera independiente en cada parte.  También se pueden
usar diferentes funciones de división en páginas para las distintas
partes del libro.

@example
\bookpart @{
  \header @{
    subtitle = "Prefacio"
  @}
  \paper @{
     %% En una parte que consiste en texto principalmente,
     %% puede ser preferible ly:minimal-breaking
     #(define page-breaking ly:minimal-breaking)
  @}
  \markup @{ @dots{} @}
  @dots{}
@}
\bookpart @{
  %% En esta parte, consistente en música, se usa la función
  %% óptima predeterminada de saltos de página.
  \header @{
    subtitle = "Primer movimiento"
  @}
  \score @{ @dots{} @}
  @dots{}
@}
@end example


@predefined
@funindex \pageBreak
@code{\pageBreak},
@funindex \noPageBreak
@code{\noPageBreak}.
@endpredefined


@seealso
Fragmentos de código:
@rlsr{Spacing}.


@node Saltos de página óptimos
@subsection Saltos de página óptimos
@translationof Optimal page breaking

@funindex ly:optimal-breaking

La función @code{ly:optimal-breaking} es el método predeterminado de
LilyPond para determinar los saltos de página.  Intenta hallar una
división de páginas que haga mínimos el apretujamiento y la
distensión, tanto horizontal como verticalmente.  A diferencia de
@code{ly:page-turn-breaking}, no tiene un concepto de los pasos de
página.


@seealso
Fragmentos de código:
@rlsr{Spacing}.


@node Paso de página óptimo
@subsection Paso de página óptimo
@translationof Optimal page turning

@funindex ly:page-turn-breaking

Con frecuencia es necesario encontrar una configuración de división de
páginas de manera que haya un silencio al final de una página de cada
dos.  De esta forma, el músico puede pasar la página sin perder notas.
La función @code{ly:page-turn-breaking} trata de encontrar una
división de páginas que haga mínimos el apretujamiento y el
estiramiento, pero con la restricción añadida de que sólo se permite
introducir vueltas de página en los lugares especificados.

Hay dos etapas en el uso de esta función de división de páginas.  En
primer lugar debemos habilitarlo en el bloque @code{\paper}, como se
explicó en @ref{Saltos de página}.  Entonces debemos decirle a la función
dónde nos gustaría permitir los saltos de página.

Hay dos formas de conseguir la segunda tarea.  Primero, podemos
especificar manualmente cada uno de los pasos de página potenciales,
insertando @code{\allowPageTurn} en nuestro archivo de entrada en los
lugares adecuados.

Si esto es demasiado tedioso, podemos añadir un grabador
@code{Page_turn_engraver} a un contexto Staff o Voice.  El grabador
@code{Page_turn_engraver} analizará el contexto en busca de secciones
sin notas (observe que no busca silencios, sino la ausencia de notas.
Se hace así para que la polifonía en un solo pentagrama con silencios
en una de las voces no arruine la labor del grabador
@code{Page_turn_engraver}).  Cuando encuentra una sección sin notas
suficientemente larga, el grabador @code{Page_turn_engraver} inserta
un @code{\allowPageTurn} en la última barra de compás de dicha
sección, a no ser que haya una barra @q{especial} de compás (como una
doble barra), en cuyo caso se insertará el @code{\allowPageTurn} en la
última barra @q{especial} de compás de la sección.

@funindex minimumPageTurnLength
El grabador @code{Page_turn_engraver} lee la propiedad de contexto
@code{minimumPageTurnLength} para determinar qué longitud debe tener
una sección sin notas antes de que se considere la posibilidad de un
paso de página.  El valor predeterminado para
@code{minimumPageTurnLength} es @code{#(ly:make-moment 1 1)}.  Si
quiere inhabilitar las vueltas de página, puede establecerlo a algún
valor muy grande.

@example
\new Staff \with @{ \consists "Page_turn_engraver" @}
@{
  a4 b c d |
  R1 | % a page turn will be allowed here
  a4 b c d |
  \set Staff.minimumPageTurnLength = #(ly:make-moment 5 2)
  R1 | % a page turn will not be allowed here
  a4 b r2 |
  R1*2 | % a page turn will be allowed here
  a1
@}
@end example

@funindex minimumRepeatLengthForPageTurn
El grabador @code{Page_turn_engraver} detecta las repeticiones de
primera y segunda vez.  Sólo permite un pase de página durante la
repetición si hay suficiente tiempo al principio y al final de la
repetición para volver a pasar la página hacia atrás. El grabador
@code{Page_turn_engraver} también puede inhabilitar los pasos de
página si la repetición es muy corta.  Si establecemos la propiedad de
contexto @code{minimumRepeatLengthForPageTurn} entonces el grabador
@code{Page_turn_engraver} sólo permitirá los pases de página en las
repeticiones cuya duración sea mayor que este valor.

Las instrucciones de paso de página, @code{\pageTurn},
@code{\noPageTurn} y @code{\allowPageTurn}, se pueden usar también en
el nivel más elevado del código, entre las partituras y los elementos
de marcado del nivel superior.


@predefined
@funindex \pageTurn
@code{\pageTurn},
@funindex \noPageTurn
@code{\noPageTurn},
@funindex \allowPageTurn
@code{\allowPageTurn}.
@endpredefined


@seealso
Fragmentos de código:
@rlsr{Spacing}.


@knownissues

Sólo debería haber un grabador @code{Page_turn_engraver} dentro de una
partitura.  Si hay más de uno, se interferirán entre sí.


@node Saltos de página mínimos
@subsection Saltos de página mínimos
@translationof Minimal page breaking

@funindex ly:minimal-breaking

La función @code{ly:minimal-breaking} efectúa unos cálculos mínimos
para determinar los saltos de página: completa una página con tantos
sistemas como sea posible antes de continuar con la siguiente.  Así,
puede preferirse para partituras con muchas páginas, donde las otras
funciones de salto de página pueden resultar demasiado lentas o ávidas
de memoria, o con una gran cantidad de textos.  Se habilita utilizando:

@example
\paper @{
  #(define page-breaking ly:minimal-breaking)
@}
@end example


@seealso
Fragmentos de código:
@rlsr{Spacing}.


@node Saltos de línea explícitos
@subsection Saltos de línea explícitos
@translationof Explicit breaks

Lily a veces rechaza las instrucciones @code{\break} y
@code{\pageBreak} explícitas.  Hay dos instrucciones para
sobreescribir este comportamiento:

@example
\override NonMusicalPaperColumn #'line-break-permission = ##f
\override NonMusicalPaperColumn #'page-break-permission = ##f
@end example

Cuando se sobreescribe el valor de @code{line-break-permission} a
falso, Lily inserta saltos de línea en las instrucciones @code{\break}
explícitas y en ningún otro lugar. Cuando se sobreescribe el valor de
@code{page-break-permission} a falso, Lily inserta saltos de página en
las instrucciones @code{\pageBreak} explícitas y en ningún otro lugar.

@lilypond[quote,verbatim]
\paper {
  indent = #0
  ragged-right = ##t
  ragged-bottom = ##t
}

\score {
  \new Staff {
    \repeat unfold 2 { c'8 c'8 c'8 c'8 } \break
    \repeat unfold 4 { c'8 c'8 c'8 c'8 } \break
    \repeat unfold 6 { c'8 c'8 c'8 c'8 } \break
    \repeat unfold 8 { c'8 c'8 c'8 c'8 } \pageBreak
    \repeat unfold 8 { c'8 c'8 c'8 c'8 } \break
    \repeat unfold 6 { c'8 c'8 c'8 c'8 } \break
    \repeat unfold 4 { c'8 c'8 c'8 c'8 } \break
    \repeat unfold 2 { c'8 c'8 c'8 c'8 }
    }
  \layout {
    \context {
      \Score
      \override NonMusicalPaperColumn #'line-break-permission = ##f
      \override NonMusicalPaperColumn #'page-break-permission = ##f
    }
  }
}
@end lilypond


@seealso
Fragmentos de código:
@rlsr{Spacing}.


@node Utilizar una voz adicional para los saltos de línea
@subsection Utilizar una voz adicional para los saltos de línea
@translationof Using an extra voice for breaks

La información sobre saltos de línea y de página suele aparecer
directamente entremezclado dentro del código de notas.

@example
\score @{
  \new Staff @{
    \repeat unfold 2 @{ c'4 c'4 c'4 c'4 @}
    \break
    \repeat unfold 3 @{ c'4 c'4 c'4 c'4 @}
  @}
@}
@end example


Esto hace sencillas de introducir a las instrucciones @code{\break} y
@code{\pageBreak}, pero mezcla la escritura de música con información
que especifica cómo se debe disponer la música sobre la página.
Podemos mantener la introducción de música y la información de saltos
de línea y de página en dos lugares separados mediante la introducción
de una voz adicional que contenga los saltos.  Esta voz adicional
contiene solamente desplazamientos o @q{skips} junto con los
@code{\break}, @code{pageBreak} y otras informaciones sobre la
disposición de los saltos.

@lilypond[quote,verbatim]
\score {
  \new Staff <<
    \new Voice {
      s1 * 2 \break
      s1 * 3 \break
      s1 * 6 \break
      s1 * 5 \break
    }
    \new Voice {
      \repeat unfold 2 { c'4 c'4 c'4 c'4 }
      \repeat unfold 3 { c'4 c'4 c'4 c'4 }
      \repeat unfold 6 { c'4 c'4 c'4 c'4 }
      \repeat unfold 5 { c'4 c'4 c'4 c'4 }
    }
  >>
}
@end lilypond

Este patrón resulta especialmente útil cuando se sobreescribe
@code{line-break-system-details} y las otras útiles (pero largas)
propiedades de @code{NonMusicalPaperColumnGrob}, como se explica en
@ref{Espaciado vertical}.

@lilypond[quote,verbatim]
\score {
  \new Staff <<
    \new Voice {
      \overrideProperty "Score.NonMusicalPaperColumn"
        #'line-break-system-details #'((Y-offset . 0))
      s1 * 2 \break

      \overrideProperty "Score.NonMusicalPaperColumn"
        #'line-break-system-details #'((Y-offset . 35))
      s1 * 3 \break

      \overrideProperty "Score.NonMusicalPaperColumn"
        #'line-break-system-details #'((Y-offset . 70))
      s1 * 6 \break

      \overrideProperty "Score.NonMusicalPaperColumn"
        #'line-break-system-details #'((Y-offset . 105))
      s1 * 5 \break
    }
    \new Voice {
      \repeat unfold 2 { c'4 c'4 c'4 c'4 }
      \repeat unfold 3 { c'4 c'4 c'4 c'4 }
      \repeat unfold 6 { c'4 c'4 c'4 c'4 }
      \repeat unfold 5 { c'4 c'4 c'4 c'4 }
    }
  >>
}
@end lilypond


@seealso
Referencia de la notación:
@ref{Espaciado vertical}.

Fragmentos de código:
@rlsr{Spacing}.


@node Espaciado vertical
@section Espaciado vertical
@translationof Vertical spacing

@cindex espaciado vertical
@cindex vertical, espaciado

El espaciado vertical está controlado por tres factores: la cantidad
de espacio disponible (es decir, el tamaño del papel y los márgenes),
la separación entre los sistemas, y la separación entre los
pentagramas dentro de un sistema.

@menu
* Espaciado vertical dentro de un sistema::
* Espaciado vertical entre sistemas::
* Posicionamiento explícito de los pentagramas y los sistemas::
* Evitar las colisiones verticales::
@end menu


@node Espaciado vertical dentro de un sistema
@subsection Espaciado vertical dentro de un sistema
@translationof Vertical spacing inside a system

@cindex distancia entre pentagramas
@cindex pentagrama, distancia entre los
@cindex espacio entre pentagramas
@cindex espacio dentro de los sistemas

La altura de cada sistema se determina en dos fases.  Primero, todos
los pentagramas se disponen según la cantidad de espacio vacío
disponible.  Después, las líneas que no son pautas (p.ej. la letra o
los nombres de acorde) se distribuyen entre las pautas.

@unnumberedsubsubsec Espaciado entre los pentagramas
El espaciado entre los pentagramas se controla mediante la propiedad
@var{next-staff-spacing} del grob @var{VerticalAxisGroup}.  Esta
propiedad es una lista-A de cuatro elementos: @var{space},
@var{minimum-distance}, @var{padding} y @var{stretchability}:
@itemize
@item
@var{space} es el tamaño del espacio ensanchable entre la línea media
de un pentagrama hasta la línea media del pentagrama siguiente.

@item
@var{minimum-distance} proporciona un límite inferior sobre la
distancia final entre la línea central de un pentagrama hasta la línea
central del pentagrama siguiente.  Esto es, si una página tiene muchos
sistemas y necesita comprimirse, la distancia desde este pentagrama
hasta el siguiente nunca se comprimirá a menos de
@var{minimum-distance}.

@item
@var{padding} es la cantidad de espacio vacío que debe estar presente
entre el final de un pentagrama y el principio del siguiente.  Se
diferencia de @var{minimum-distance} en que el efecto de @var{padding}
depende de la altura de los objetos que están sobre el pentagrama.
Por ejemplo, es más probable que @var{padding} entre en efecto para
pentagramas que tienen notas muy agudas por encima de la pauta.

@item
@var{stretchability} controla la propensión del espacio ensanchable a
ampliarse cuando lo hace el sistema.  Los valores grandes producen que
un sistema se amplíe más, mientras que un valor de cero evita que el
espacio se amplíe en absoluto.  Si se deja sin establecer, el valor
predeterminado de @var{stretchability} será @code{space -
minimum-distance}.
@end itemize

@lilypond[verbatim]
#(set-global-staff-size 16)
\new StaffGroup <<
  % Since space is small and there is no minimum-distance, the distance
  % between this staff and the next will be determined by padding.
  \new Staff \with {
    \override VerticalAxisGroup #'next-staff-spacing =
      #'((space . 1) (padding . 1))
  }
  { \clef bass c, }
  % Since space is small and nothing sticks out very far, the distance
  % between this staff and the next will be determined by minimum-distance.
  \new Staff \with {
    \override VerticalAxisGroup #'next-staff-spacing =
      #'((space . 1) (minimum-distance . 12))
  }
  { \clef bass c, }
  % By setting padding to a negative value, staves can be made to collide.
  \new Staff \with {
    \override VerticalAxisGroup #'next-staff-spacing =
      #'((space . 4) (padding . -10))
  }
  { \clef bass c, }
  \new Staff { \clef bass c, }
>>
@end lilypond


En partituras grandes como las orquestales, es común colocar los
pentagramas en grupos.  El espacio entre los grupos suele ser mayor
que el espacio que hay entre los pentagramas dentro del mismo grupo.
Este espacio se puede manipular con el grob @var{StaffGrouper}: el
valor predeterminado de @var{next-staff-spacing} para
@var{VerticalAxisGroup} es una función de @q{callback} que opera por
el procedimiento de buscar un grob @var{StaffGrouper} que contenga al
pentagrama.  Si encuentra un grob @var{StaffGrouper} y el pentagrama
en cuestión está en mitad de un grupo, lee la propiedad
@var{between-staff-spacing} de @var{StaffGrouper} y la devuelve.  Si
el pentagrama en cuestión es el último de un grupo, la función de
@q{callback} lee la propiedad @var{after-last-staff-spacing} de
@var{StaffGrouper} y la devuelve.  Si no encuentra un grob
@var{StaffGrouper}, lee @var{default-next-staff-spacing} a partir de
su @var{VerticalAxisGroup} y lo devuelve.

@lilypond[verbatim]
#(set-global-staff-size 16)
<<
  \new PianoStaff \with {
    \override StaffGrouper #'between-staff-spacing #'space = #1
    \override StaffGrouper #'between-staff-spacing #'padding = #0
    \override StaffGrouper #'after-last-staff-spacing #'space = #20
  }
  <<
    \new Staff c'1
    \new Staff c'1
  >>

  \new StaffGroup \with {
    \override StaffGrouper #'between-staff-spacing #'space = #1
    \override StaffGrouper #'between-staff-spacing #'padding = #0
  }
  <<
    \new Staff c'1
    \new Staff c'1
  >>
>>
@end lilypond


@unnumberedsubsubsec Espaciado de las líneas que no son pautas

Después de que se han determinado las posiciones de los pentagramas,
se distribuyen las líneas que no son pautas entre los pentagramas.
Cada una de esas líneas tiene una propiedad @var{staff-affinity} que
controla su alineamiento vertical.  Por ejemplo:

@example
\new Lyrics \with @{ \override VerticalAxisGroup #'staff-affinity = #DOWN @}
@end example

@noindent
crea un contexto de letra que se situará junto al pentagrama que tiene
por debajo.  El establecimiento de @var{staff-affinity} a algo que no
sea un número (@code{#f}, por ejemplo) hace que la línea se trate como
si fuera una pauta.  De forma recíproca, el establecimiento de
@var{staff-affinity} para un pentagrama hace que se le trate como si
no fuera una pauta.

Las líneas que no son pautas admiten tres propiedades para controlar
su espaciado.  Cada una de estas propiedades es una lista-A del mismo
formato que @var{next-staff-spacing}, véase más arriba.
@itemize
@item
Si la línea más cercana en la dirección de @var{staff-affinity} es una
pauta, entonces @var{inter-staff-spacing} da el espacio entre la línea
que no es una pauta y la pauta.  Si @var{staff-affinity} es
@code{CENTER}, entonces se usa @var{inter-staff-spacing} para las dos
direcciones.

@item
Si línea más cercana en la dirección de @var{staff-affinity} no es una
pauta, entonces @var{inter-loose-line-spacing} da el espaciado entre
las dos líneas que no son pautas.

@item
Si la línea más cercana en la dirección opuesta a @var{staff-affinity}
es una pauta, entonces @var{non-affinity-spacing} da el espacio entre
la línea que no es una pauta y la pauta.  esto se puede usar, por
ejemplo, para requerir una cantidad de relleno mínima entre una línea
de letra y el pentagrama a que no pertenece.
@end itemize

@lilypond[verbatim]
#(set-global-staff-size 16)
\layout {
  \context {
    \Lyrics
    % By default, Lyrics are placed close together. Here, we allow them to
    % be stretched more widely.
    \override VerticalAxisGroup
      #'inter-loose-line-spacing #'stretchability = #1000
  }
}

\new StaffGroup
<<
  \new Staff \with {
    \override VerticalAxisGroup #'next-staff-spacing = #'((space . 30)) }
    { c'1 }
  \new Lyrics \with {
    \override VerticalAxisGroup #'staff-affinity = #UP }
    \lyricmode { up }
  \new Lyrics \with {
    \override VerticalAxisGroup #'staff-affinity = #CENTER }
    \lyricmode { center }
  \new Lyrics \with {
    \override VerticalAxisGroup #'staff-affinity = #DOWN }
    \lyricmode { down }
  \new Staff
    { c'1 }
>>
@end lilypond

@seealso
Fragmentos de código:
@rlsr{Spacing}.

@c @lsr{spacing,page-spacing.ly},
@c @lsr{spacing,alignment-vertical-spacing.ly}.

Referencia de funcionamiento interno:
@rinternals{VerticalAxisGroup},
@rinternals{VerticalAlignment},
@rinternals{Axis_group_engraver}.

@knownissues
Las líneas adyacentes que no son pentagramas debieran tener valores de
@var{staff-affinity} no crecientes desde arriba hasta abajo.  Por
ejemplo, el comportamiento de
@example
<<
  \new Staff c
  \new Lyrics \with @{ \override VerticalAxisGroup #'staff-affinity = #DOWN @}
  \new Lyrics \with @{ \override VerticalAxisGroup #'staff-affinity = #UP @}
  \new Staff c
>>
@end example
es indeterminado.

Una línea que no es una pauta, al final de un sistema, debiera tener
establecido @var{staff-affinity} al valor @code{UP}.  De forma
similar, una línea que no es una pauta al principio de un sistema
debiera tener @var{staff-affinity} establecido al valor @code{DOWN}.

@node Espaciado vertical entre sistemas
@subsection Espaciado vertical entre sistemas
@translationof Vertical spacing between systems

Los mecanismos que controlan el espaciado entre sistemas son similares
a los que controlan el espaciado dentro de un sistema (véase
@ref{Espaciado vertical dentro de un sistema}).  La diferencia
principal es que las variables para controlar el espaciado entre
sistemas se establece dentro del bloque @code{\paper} en lugar de
hacerlo como propiedades de grob.  Estas variables del bloque paper
son @var{system-system-spacing}, @var{score-system-spacing},
@var{markup-system-spacing}, @var{score-markup-spacing},
@var{markup-markup-spacing}, @var{top-system-spacing},
@var{top-markup-spacing} y @var{last-bottom-spacing}.  Observe que
estas variables ignoran las líneas que nos son pautas.  Por ejemplo,
@var{system-system-spacing} controla el espaciado desde la línea
media del pentagrama inferior de un sistema hasta la línea del
pentagrama superior del sistema siguiente, tanto si hay letra debajo
del sistema superior como si no.  Consulte @ref{Dimensiones
verticales} para ver una descripción de cada una de dichas variables.

Aún hay otras dos variables del bloque @code{\paper} que afectan al
espaciado vertical: si @var{ragged-bottom} está ajustado a @code{##t},
ninguna página se amplía (lo que significa que no se ampliará ni el
espacio entre sistemas ni el espacio dentro de los sistemas).  Si el
valor de @var{ragged-last-bottom} se ajusta a @code{##t} entonces la
última página no se amplía.

@seealso
Fragmentos de código:
@rlsr{Spacing}.


@node Posicionamiento explícito de los pentagramas y los sistemas
@subsection Posicionamiento explícito de los pentagramas y los sistemas
@translationof Explicit staff and system positioning

Una forma de entender los ajustes de @code{VerticalAxisGroup} y de
@code{\paper} que se explicaron en las dos secciones anteriores es
como una colección de distintos ajustes que conciernen principalmente
a la cantidad de relleno vertical que adquieren los distintos
pentagramas y sistemas al ocupar la página.

Es posible abordar el problema del espaciado vertical de una forma
distinta utilizando @code{NonMusicalPaperColumn
#'line-break-system-details}.  Donde los ajustes de
@code{VerticalAxisGroup} y de @code{\paper} especifican el relleno
vertical, @code{NonMusicalPaperColumn #'line-break-system-details}
especifica las posiciones verticales exactas en la página.

@code{NonMusicalPaperColumn #'line-break-system-details} acepta una
lista asociativa de tres ajustes distintos:

@itemize
@item @code{X-offset}
@item @code{Y-offset}
@item @code{alignment-distances}
@end itemize

Las sobreescrituras de los objetos gráficos, entre ellas las de
@code{NonMusicalPaperColumn} que aparece más abajo, pueden ocurrir en
tres lugares distintos dentro de un archivo de entrada:

@itemize
@item directamente en medio de las notas
@item en un bloque @code{\context}
@item en el bloque @code{\with}
@end itemize

Cuando sobreescribimos @code{NonMusicalPaperColumn}, usamos la
instrucción @code{\override} usual en los bloques @code{\context} y en
el bloque @code{\with}.  Por otra parte, cuando sobreescribimos
@code{NonMusicalPaperColumn} en medio de las notas, debemos usar la
instrucción especial @code{\overrideProperty}.  He aquí algunas
sobreescrituras de @code{NonMusicalPaperColumn} de ejemplo con la
instrucción especial @code{\overrideProperty}:

@example
\overrideProperty NonMusicalPaperColumn
  #'line-break-system-details #'((X-offset . 20))

\overrideProperty NonMusicalPaperColumn
  #'line-break-system-details #'((Y-offset . 40))

\overrideProperty NonMusicalPaperColumn
  #'line-break-system-details #'((X-offset . 20) (Y-offset . 40))

\overrideProperty NonMusicalPaperColumn
  #'line-break-system-details #'((alignment-distances . (15)))

\overrideProperty NonMusicalPaperColumn
  #'line-break-system-details #'((X-offset . 20) (Y-offset . 40)
                                 (alignment-distances . (15)))
@end example

Para entender cómo funciona cada uno de los distintos ajustes,
empezamos observando un ejemplo que no incluye absolutamente ninguna
sobreescritura.

@c \book { } is required in these examples to ensure the spacing
@c overrides can be seen between systems. -np

@lilypond[quote]
\header { tagline = ##f }
\paper { left-margin = 0\mm }
\book {
  \score {
    <<
      \new Staff <<
        \new Voice {
          s1*5 \break
          s1*5 \break
          s1*5 \break
        }
        \new Voice { \repeat unfold 15 { c'4 c' c' c' } }
      >>
      \new Staff {
        \repeat unfold 15 { d'4 d' d' d' }
      }
    >>
  }
}
@end lilypond

Esta partitura mantiene aislada la información de los saltos de línea
y de página en una voz dedicada a ello.  Esta técnica de crear una voz
de saltos ayuda a mantener separada de la escritura de notas conforme
el ejemplo se vuelve más complicado.  Consulte @ref{Utilizar una voz adicional para los saltos de línea}.

Los saltos explícitos dividen la música de forma regular en seis
compases por línea.  El espaciado vertical es el resultado de los
ajustes predeterminados de LilyPond.  Para establecer explícitamente
el punto de origen vertical de cada sistema, podemos establecer el par
@code{Y-offset} en el atributo @code{line-break-system-details} del
grob (objeto gráfico) @code{NonMusicalPaperColumn}:

@lilypond[quote]
\header { tagline = ##f }
\paper { left-margin = 0\mm }
\book {
  \score {
    <<
      \new Staff <<
        \new Voice {
          \overrideProperty #"Score.NonMusicalPaperColumn"
            #'line-break-system-details #'((Y-offset . 0))
          s1*5 \break
          \overrideProperty #"Score.NonMusicalPaperColumn"
            #'line-break-system-details #'((Y-offset . 40))
          s1*5 \break
          \overrideProperty #"Score.NonMusicalPaperColumn"
            #'line-break-system-details #'((Y-offset . 80))
          s1*5 \break
        }
        \new Voice { \repeat unfold 15 { c'4 c' c' c' } }
      >>
      \new Staff {
        \repeat unfold 15 { d'4 d' d' d' }
      }
    >>
  }
}
@end lilypond

Observe que @code{line-break-system-details} toma una lista asociativa
de una cantidad de valores potencialmente elevada, pero aquí sólo
fijamos un valor.  Observe también que aquí la propiedad
@code{Y-offset} determina la posición vertical exacta sobre la página
en la que se trazará cada uno de los nuevos sistemas.

Ahora que hemos establecido explícitamente el punto de origen vertical
de cada sistema, podemos también establecer manualmente
las distancias verticales entre
los pentagramas dentro de cada sistema.  Lo hacemos
usando la subpropiedad @code{alignment-distances} de
@code{line-break-system-details}.

@lilypond[quote]
\header { tagline = ##f }
\paper { left-margin = 0\mm }
\book {
  \score {
    <<
      \new Staff <<
        \new Voice {
          \overrideProperty #"Score.NonMusicalPaperColumn"
            #'line-break-system-details #'((Y-offset . 20)
                                           (alignment-distances . (15)))
          s1*5 \break
          \overrideProperty #"Score.NonMusicalPaperColumn"
            #'line-break-system-details #'((Y-offset . 60)
                                           (alignment-distances . (15)))
          s1*5 \break
          \overrideProperty #"Score.NonMusicalPaperColumn"
            #'line-break-system-details #'((Y-offset . 100)
                                           (alignment-distances . (15)))
          s1*5 \break
        }
        \new Voice { \repeat unfold 15 { c'4 c' c' c' } }
      >>
      \new Staff {
        \repeat unfold 15 { d'4 d' d' d' }
      }
    >>
  }
}
@end lilypond

Observe que aquí asignamos dos valores distintos al atributo
@code{line-break-system-details} del grob
@code{NonMusicalPaperColumn}.  Aunque el atributo alist de
@code{line-break-system-details} acepta muchos parámetros de espaciado
adicionales (entre ellos, por ejemplo, un par @code{X-offset}
correspondiente), sólo tenemos que establecer el desplazamiento
@code{Y-offset} y los pares @code{alignment-distances} para controlar el
punto de origen vertical de cada sistema y pentagrama.  Finalmente,
observe que @code{alignment-distances} especifica el posicionamiento
vertical de los pentagramas pero no de los grupos de pentagramas.

@lilypond[quote]
\header { tagline = ##f }
\paper { left-margin = 0\mm }
\book {
  \score {
    <<
      \new Staff <<
        \new Voice {
          \overrideProperty #"Score.NonMusicalPaperColumn"
            #'line-break-system-details #'((Y-offset . 0)
                                           (alignment-distances . (30 10)))
          s1*5 \break
          \overrideProperty #"Score.NonMusicalPaperColumn"
            #'line-break-system-details #'((Y-offset . 60)
                                           (alignment-distances . (10 10)))
          s1*5 \break
          \overrideProperty #"Score.NonMusicalPaperColumn"
            #'line-break-system-details #'((Y-offset . 100)
                                           (alignment-distances . (10 30)))
          s1*5 \break
        }
        \new Voice { \repeat unfold 15 { c'4 c' c' c' } }
      >>
      \new StaffGroup <<
        \new Staff { \repeat unfold 15 { d'4 d' d' d' } }
        \new Staff { \repeat unfold 15 { e'4 e' e' e' } }
      >>
    >>
  }
}
@end lilypond

Algunos puntos que tener en cuenta:

@itemize
@item Al usar @code{alignment-distances}, la letra
y otras líneas que no son pautas, no cuentan como un pentagrama.

@item Las unidades de los números que se pasan a @code{X-offset},
@code{Y-offset} y @code{alignment-distances} se interpretan como
múltiplos de la distancia entre líneas de pentagrama adyacentes.  Los
valores positivos mueven a los pentagramas y a la letra hacia arriba,
los valores negativos mueven los pentagramas y la letra hacia abajo.

@item A causa de que los ajustes a @code{NonMusicalPaperColumn #'line-break-system-details}
dados aquí permiten el posicionamiento de pentagramas y sistemas en
cualquier lugar de la página, es posible violar los márgenes o los
límites del papel, o incluso imprimir pentagramas o sistemas unos
encima de otros.  Esto se evitaría pasando a los diferentes ajustes
unos valores razonables.
@end itemize


@seealso
Fragmentos de código:
@rlsr{Spacing}.


@node Evitar las colisiones verticales
@subsection Evitar las colisiones verticales
@translationof Vertical collision avoidance

@funindex outside-staff-priority
@funindex outside-staff-padding
@funindex outside-staff-horizontal-padding

Podemos decir intuitivamente que algunos objetos de la notación
musical pertenecen al pentagrama y otros se sitúan fuera del
pentagrama.  Entre los objetos que pertenecen al exterior del
pentagrama están las marcas de ensayo, las marcas textuales y las
indicaciones de dinámica (en lo sucesivo, les llamaremos objetos fuera
del pentagrama).  La regla de LilyPond para la colocación vertical de
los objetos fuera del pentagrama es ponerlos tan cerca del pentagrama
como sea posible pero no tan próximos como para que choquen con otro
objeto.

LilyPond utiliza la propiedad @code{outside-staff-priority} para
determinar si un grob es un objeto fuera del pentagrama: si
@code{outside-staff-priority} es un número, el grob es un objeto fuera
del pentagrama.  Además, @code{outside-staff-priority} informa a
LilyPond en qué orden se debe situar los objetos.

En primer lugar, LilyPond sitúa todos los objetos que no pertenecen al
exterior del pentagrama.  Después ordena los objetos fuera del
pentagrama de acuerdo a su prioridad @code{outside-staff-priority} (en
orden creciente).  LilyPond toma los objetos fuera del pentagrama uno
a uno y los coloca de forma que no choquen con ningún objeto que ya
haya sido colocado.  Esto es, si dos grobs fuera del pentagrama
compiten por el mismo espacio, el que tiene la prioridad
@code{outside-staff-priority} más baja se colocará más próximo al
pentagrama.

@lilypond[quote,ragged-right,relative=2,fragment,verbatim]
c4_"Text"\pp
r2.
\once \override TextScript #'outside-staff-priority = #1
c4_"Text"\pp % this time the text will be closer to the staff
r2.
% by setting outside-staff-priority to a non-number,
% we disable the automatic collision avoidance
\once \override TextScript #'outside-staff-priority = ##f
\once \override DynamicLineSpanner #'outside-staff-priority = ##f
c4_"Text"\pp % now they will collide
@end lilypond

El relleno vertical entre un objeto fuera del pentagrama y los grobs
posicionados previamente se puede controlar con
@code{outside-staff-padding}.

@lilypond[quote,ragged-right,relative=2,fragment,verbatim]
\once \override TextScript #'outside-staff-padding = #0
a'^"This text is placed very close to the note"
\once \override TextScript #'outside-staff-padding = #3
c^"This text is padded away from the previous text"
c^"This text is placed close to the previous text"
@end lilypond

De forma predeterminada, los objetos fuera del pentagrama se colocan
sólo para evitar una colisión horizontal con los grobs posicionados
previamente.  Esto puede llevar a situaciones en las que los objetos
se colocan muy próximos entre sí en el sentido horizontal.  El espacio
vertical entre pentagramas se puede fijar también de manera que los
objetos fuera del pentagrama se sitúen de forma intercalada.  El
establecimiento del relleno horizontal
@code{outside-staff-horizontal-padding} ocasiona que un objeto se
desplace verticalmente para que tal situación no ocurra.

@lilypond[quote,ragged-right,relative=2,fragment,verbatim]
% the markup is too close to the following note
c4^"Text"
c4
c''2
% setting outside-staff-horizontal-padding fixes this
R1
\once \override TextScript #'outside-staff-horizontal-padding = #1
c,,4^"Text"
c4
c''2
@end lilypond


@seealso
Fragmentos de código:
@rlsr{Spacing}.


@node Espaciado horizontal
@section Espaciado horizontal
@translationof Horizontal spacing

@cindex horizontal, espaciado
@cindex espaciado horizontal

@menu
* Panorámica del espaciado horizontal::
* Área de espaciado nueva::
* Cambiar el espaciado horizontal::
* Longitud de la línea::
* Notación proporcional::
@end menu


@node Panorámica del espaciado horizontal
@subsection Panorámica del espaciado horizontal
@translationof Horizontal spacing overview

El motor de espaciado traduce las diferencias en las duraciones a
distancias ampliables (@q{muelles}) de distintas longitudes.  Las
duraciones más largas reciben un espacio mayor y las duraciones más
cortas reciben menos.  Las duraciones más breves reciben un espacio de
tamaño fijo (que se controla mediante @code{shortest-duration-space}
en el objeto @rinternals{SpacingSpanner}).  Cuanto más larga es la
duración, más espacio recibe: al doblar una duración se añade un
espacio de tamaño fijo (este tamaño se controla mediante
@code{spacing-increment}) a la nota.

Por ejemplo, la pieza siguiente contiene numerosas blancas, negras y
corcheas; la corchea va seguida de un ancho de cabeza de blanca (ACB).
La negra va seguida de 2 ACB, la blanca por 3 ACB, etc.

@lilypond[quote,fragment,verbatim,relative=1]
c2 c4. c8 c4. c8 c4. c8 c8
c8 c4 c4 c4
@end lilypond

Normalmente, el valor de @code{spacing-increment} está establecido en
1.2 espacios de pentagrama, lo que es aproximadamente el ancho de una
cabeza, y @code{shortest-duration-space} está establecido en 2.0, lo
que significa que la nota más breve recibe 2.4 espacios de pentagrama
(2.0 multiplicado por el @code{spacing-increment}) de espacio
horizontal.  Este espacio se cuenta a partir del borde izquierdo del
símbolo, de manera que las notas más breves van seguidas generalmente
por un espacio de 1 ACB.

Si siguiésemos el procedimiento anterior exactamente, entonces la
adición de una sola fusa a una partitura que usa corcheas y
semicorcheas, aumentaría enormemente la anchura de la partitura
completa.  La nota más breve ya no es la semicorchea, sino la fusa,
añadiendo así 1 ACB a cada una de las notas.  Para evitarlo, la
duración más breve a efectos de espaciado no es la nota más breve de
la partitura, sino la que ocurre con más frecuencia.

La duración más breve que es más común se determina de la siguiente
manera: en cada compás se determina la duración más breve.  La menor
duración más común se toma como base para el espaciado, habiendo
estipulado que esta duración menor siempre debe ser igual o menor que
una corchea.  La duración más breve se imprime cuando se ejecuta
@code{lilypond} con la opción @code{--verbose}.

Estas duraciones también se pueden personalizar.  Si establecemos la
@code{common-shortest-duration} en @rinternals{SpacingSpanner},
entonces éste establece la duración base para el espaciado.  La
duración máxima para esta base (normalmente una corchea), se fija a
través de @code{base-shortest-duration}.

@funindex common-shortest-duration
@funindex base-shortest-duration
@funindex stem-spacing-correction
@funindex spacing

Las notas que son aún más breves que la nota común más breve van
seguidas por un espacio proporcional a su duración en relación con la
nota común más breve.  Así pues, si fuésemos a añadir tan sólo algunas
semicorcheas al ejemplo anterior, irían seguidas por medio ACB:

@lilypond[quote,fragment,verbatim,relative=2]
c2 c4. c8 c4. c16[ c] c4. c8 c8 c8 c4 c4 c4
@end lilypond


En el @emph{Ensayo sobre grabado musical automatizado},
se explicó que las
direcciones de las plicas influyen en el espaciado
(véase @ressay{Espaciado óptico}).  Esto se controla
con la propiedad @code{stem-spacing-correction} en el objeto
@rinternals{NoteSpacing}.  Estos se generan para cada uno de los
contextos de @rinternals{Voice}.  El objeto @code{StaffSpacing}
(generado en el contexto de @rinternals{Staff}) contiene la misma
propiedad para controlar el espaciado de las líneas de plica o
divisorias.  El ejemplo siguiente muestra estas correcciones, una vez
con los valores predeterminados y otra con correcciones exageradas:

@lilypond[quote,ragged-right]
{
  c'4 e''4 e'4 b'4 |
  b'4 e''4 b'4 e''4 |
  \override Staff.NoteSpacing #'stem-spacing-correction = #1.5
  \override Staff.StaffSpacing #'stem-spacing-correction = #1.5
  c'4 e''4 e'4 b'4 |
  b'4 e''4 b'4 e''4 |
}
@end lilypond

Está contemplada la notación proporcional; consulte @ref{Notación proporcional}.


@seealso
Fragmentos de código:
@rlsr{Spacing}.

Referencia de funcionamiento interno:
@rinternals{SpacingSpanner},
@rinternals{NoteSpacing},
@rinternals{StaffSpacing},
@rinternals{NonMusicalPaperColumn}.


@knownissues

No existe ningún mecanismo conveniente para sobreescribir el espaciado
manualmente.  Se puede usar el siguiente rodeo para insertar espacio
adicional en una partitura, ajustando el valor del relleno en la
medida necesaria.

@example
 \override Score.NonMusicalPaperColumn #'padding = #10
@end example

No existe ningún rodeo para disminuir la magnitud de la separación.


@node Área de espaciado nueva
@subsection Área de espaciado nueva
@translationof New spacing area

Se pueden iniciar secciones nuevas con diferentes parámetros de
espaciado, con @code{newSpacingSection}.  Esto es útil cuando hay
secciones que tienen distinta noción de las notas largas y cortas.

En el ejemplo siguiente, el cambio de compás introduce una sección
nueva, y por ello las semicorcheas se separan de manera más amplia.

@lilypond[relative,fragment,verbatim,quote]
\time 2/4
c4 c8 c
c8 c c4 c16[ c c8] c4
\newSpacingSection
\time 4/16
c16[ c c8]
@end lilypond

La instrucción @code{\newSpacingSection} crea un nuevo objeto
@code{SpacingSpanner}, y de ahí que se puedan usar nuevas
instrucciones de sobreescritura @code{\override} en dicho punto.


@seealso
Fragmentos de código:
@rlsr{Spacing}.

Referencia de funcionamiento interno:
@rinternals{SpacingSpanner}.


@node Cambiar el espaciado horizontal
@subsection Cambiar el espaciado horizontal
@translationof Changing horizontal spacing

Se puede alterar el espaciado horizontal con la propiedad
@code{base-shortest-duration}.  Aquí compararemos la misma música, una
vez sin alterar la propiedad, y luego alterándola.  Los valores
mayores de @code{ly:make-moment} producen música más pequeña.  Observe
que @code{ly:make-moment} construye una duración, por lo que @code{1
4} es una duración mayor que @code{1 16}.

@lilypond[verbatim,line-width=12\cm]
\score {
  \relative c'' {
    g4 e e2 | f4 d d2 | c4 d e f | g4 g g2 |
    g4 e e2 | f4 d d2 | c4 e g g | c,1 |
    d4 d d d | d4 e f2 | e4 e e e | e4 f g2 |
    g4 e e2 | f4 d d2 | c4 e g g | c,1 |
  }
}
@end lilypond

@lilypond[verbatim,line-width=12\cm]
\score {
  \relative c'' {
    g4 e e2 | f4 d d2 | c4 d e f | g4 g g2 |
    g4 e e2 | f4 d d2 | c4 e g g | c,1 |
    d4 d d d | d4 e f2 | e4 e e e | e4 f g2 |
    g4 e e2 | f4 d d2 | c4 e g g | c,1 |
  }
  \layout {
    \context {
      \Score
      \override SpacingSpanner
        #'base-shortest-duration = #(ly:make-moment 1 16)
    }
  }
}
@end lilypond


@snippets

De forma predeterminada, el espaciado en los grupos de valoración
especial depende de varios factores ajenos a la duración (como
alteraciones, cambios de clave, etc.).  Para pasar por alto estos
símbolos y forzar un espaciado de duraciones iguales uniforme, use
@code{Score.SpacingSpanner #'uniform-stretching}.  Esta propiedad sólo
puede cambiarse al principio de la partitura:

@lilypond[quote,ragged-right,verbatim]
\score {
  <<
    \new Staff {
      \times 4/5 {
        c8 c8 c8 c8 c8
      }
      c8 c8 c8 c8
    }
    \new Staff {
      c8 c8 c8 c8
      \times 4/5 {
        c8 c8 c8 c8 c8
      }
    }
  >>
  \layout {
    \context {
      \Score
      \override SpacingSpanner #'uniform-stretching = ##t
    }
  }
}
@end lilypond

Cuando se establece @code{strict-note-spacing}, las notas se separan
sin tener en cuenta las claves, líneas divisorias ni notas de adorno:

@lilypond[quote,ragged-right,relative=2,fragment,verbatim]
\override Score.SpacingSpanner #'strict-note-spacing = ##t
\new Staff { c8[ c \clef alto c \grace { c16[ c] } c8 c c]  c32[ c32] }
@end lilypond


@seealso
Fragmentos de código:
@rlsr{Spacing}.


@node Longitud de la línea
@subsection Longitud de la línea
@translationof Line length

@cindex saltos de página
@cindex página, saltos de

@funindex indent
@funindex line-width
@funindex ragged-right
@funindex ragged-last

@c Although line-width can be set in \layout, it should be set in paper
@c block, to get page layout right.
@c Setting indent in \paper block makes not much sense, but it works.

@c Bit verbose and vague, use examples?
Los ajustes más básicos que influyen en el espaciado son @code{indent}
y @code{line-width}.  Se definen en el bloque @code{\layout}.
Controlan el sangrado de la primera línea de música y la longitud de
las líneas.

Si se fija un valor verdadero para @code{ragged-right} en el bloque
@code{\layout}, entonces los sistemas terminan en su longitud
horizontal natural, en lugar de repartirse horizontalmente hasta
llenar toda la línea.  Esto es útil para fragmentos cortos, y para
comprobar qué tan apretado es el espaciado natural.
El valor normal predeterminado es falso, pero si la partitura
tiene un solo sistema, el valor predeterminado es verdadero.


@cindex diseño de página
@cindex página, disposición de la
@cindex vertical, espaciado

La opción @code{ragged-last} es similar a @code{ragged-right}, pero
afecta sólo a la última línea de la pieza.  No se efectúa ninguna
restricción sobre dicha línea.  El resultado es similar al formateo de
los párrafos de texto.  En un párrafo, la última línea sencillamente
ocupa su longitud horizontal natural.
@c Note that for text there are several options for the last line.
@c While Knuth TeX uses natural length, lead typesetters use the same
@c stretch as the previous line.  eTeX uses \lastlinefit to
@c interpolate between both these solutions.

@c interesting! -FV

@example
\layout @{
  indent = #0
  line-width = #150
  ragged-last = ##t
@}
@end example


@seealso
Fragmentos de código:
@rlsr{Spacing}.


@node Notación proporcional
@subsection Notación proporcional
@translationof Proportional notation

LilyPond contempla la notación proporcional, un tipo de espaciado
horizontal en el que cada nota consume una medida horizontal que
equivale exactamente a su duración rítmica.  Este tipo de espaciado
proporcional es comparable al espaciado horizontal hecho sobre un
papel milimetrado.  Ciertas partituras del finales del s.XX y
principios del s.XXI utilizan notación proporcional para clarificar
relaciones rítmicas complejas o para facilitar la colocación de líneas
cronométricas u otros gráficos directamente en la partitura.

LilyPond contempla cinco ajustes distintos para la notación
proporcional, que se pueden usar solos o combinados:

@itemize
@item @code{proportionalNotationDuration}
@item @code{uniform-stretching}
@item @code{strict-note-spacing}
@item @code{\remove Separating_line_group_engraver}
@item @code{\override PaperColumn #'used = ##t}
@end itemize

En los ejemplos que siguen, exploramos el uso de estos cinco ajustes
de la notación proporcional y examinamos la forma en que interactúan.

Comenzamos con el siguiente ejemplo de un solo compás, que usa un
espaciado clásico sin justificación por la derecha.

@lilypond[quote,verbatim,ragged-right]
\score {
  <<
    \new RhythmicStaff {
      c'2
      c'16 c'16 c'16 c'16
      \times 4/5 {
        c'16 c'16 c'16 c'16 c'16
      }
    }
  >>
}
@end lilypond

Observe que la blanca que inicia el compás ocupa mucho menos de la
mitad de todo el espacio horizontal del compás.  De forma similar, las
semicorcheas y el cinquillo de semicorcheas con que finaliza el compás
ocupan en conjunto mucho más de la mitad de todo el espacio horizontal
del compás.

En el grabado clásico, este espaciado puede ser exactamente el que
deseamos porque podemos tomar prestado el espacio horizontal de la
blanca y conservar el espacio horizontal a lo largo del compás como un
todo.

Por otro lado, si queremos insertar una línea de tiempo graduada o
algún otro gráfico encima o debajo de la partitura, necesitamos la
notación proporcional.  Se activa la notación proporcional con el
ajuste @code{proportionalNotationDuration}.

@lilypond[quote,verbatim,ragged-right]
\score {
  <<
    \new RhythmicStaff {
      c'2
      c'16 c'16 c'16 c'16
      \times 4/5 {
        c'16 c'16 c'16 c'16 c'16
      }
    }
  >>
 \layout {
    \context {
      \Score
      proportionalNotationDuration = #(ly:make-moment 1 20)
    }
  }
}
@end lilypond

La blanca al principio del compás y las notas rápidas de la segunda
mitad del compás ocupan ahora cantidades iguales de espacio
horizontal.  Podríamos colocar una línea de tiempo graduada o un
gráfico encima o debajo de este ejemplo.

El ajuste @code{proportionalNotationDuration} es un ajuste de contexto
que reside en @code{Score}.  Recordemos que los ajustes de contexto
aparecen en uno de tres posibles lugares del archivo de entrada: en un
bloque @code{\with}, en un bloque @code{\context}, o directamente
entre la música precedido por la instrucción @code{\set}.  Como con
todos los ajustes de contexto, el usuario puede elegir en cuál de los
tres lugares diferentes prefiere establecer el valor de
@code{proportionalNotationDuration}.

El ajuste @code{proportionalNotationDuration} acepta un solo
argumento, que es la duración de referencia contra el que se aplica el
espaciado de toda la música.  La función Scheme de LilyPond
@code{make-moment} acepta dos argumentos: un numerador y un
denominador que, juntos, expresan una cierta fracción de redonda.  La
llamada @code{#(ly:make-moment 1 20)}, por tanto, produce una duración
de referencia de una nota de un veinteavo de redonda (semicorcheas de
cinquillo).  Son también posibles valores como
@code{#(ly:make-moment 1 16)},
@code{#(ly:make-moment 1 8)} y @code{#(ly:make-moment 3 97)}.

¿Cómo seleccionamos la duración correcta de referencia para pasarla a
@code{proportionalNotationDuration}?  Normalmente mediante un proceso
de ensayo y error, comenzando con una duración cercana a la más rápida
(o más breve) duración de la pieza.  Las duraciones de referencia más
pequeñas aplican un espaciado más suelto; las duraciones de referencia
más largas aplican un espaciado más apretado.

@lilypond[quote,verbatim,ragged-right]
\score {
  <<
    \new RhythmicStaff {
      c'2
      c'16 c'16 c'16 c'16
      \times 4/5 {
        c'16 c'16 c'16 c'16 c'16
      }
    }
  >>
  \layout {
    \context {
      \Score
      proportionalNotationDuration = #(ly:make-moment 1 8)
    }
  }
}

\score {
  <<
    \new RhythmicStaff {
      c'2
      c'16 c'16 c'16 c'16
      \times 4/5 {
        c'16 c'16 c'16 c'16 c'16
      }
    }
  >>
  \layout {
    \context {
      \Score
      proportionalNotationDuration = #(ly:make-moment 1 16)
    }
  }
}

\score {
  <<
    \new RhythmicStaff {
      c'2
      c'16 c'16 c'16 c'16
      \times 4/5 {
        c'16 c'16 c'16 c'16 c'16
      }
    }
  >>
  \layout {
    \context {
      \Score
      proportionalNotationDuration = #(ly:make-moment 1 32)
    }
  }
}
@end lilypond

Observe que una duración de referencia demasiado grande (como la
corchea, en el ejemplo de arriba) produce un espaciado excesivamente
apretado y puede ser causa de colisiones entre las cabezas de nota.
Observe también que la notación proporcional en general ocupa más
espacio horizontal que el espaciado clásico.  El espaciado
proporcional aporta claridad rítmica a expensas del espacio
horizontal.

Ahora veremos cómo espaciar de forma óptima grupos de valoración
especial que se superponen.

Empezamos por examinar qué le ocurre a nuestro ejemplo original, con
espaciado clásico, cuando añadimos un segundo pentagrama con un tipo
diferente de grupo especial.

@lilypond[quote,verbatim,ragged-right]
\score {
  <<
    \new RhythmicStaff {
      c'2
      c'16 c'16 c'16 c'16
      \times 4/5 {
        c'16 c'16 c'16 c'16 c'16
      }
    }
    \new RhythmicStaff {
      \times 8/9 {
        c'8 c'8 c'8 c'8 c'8 c'8 c'8 c'8 c'8
      }
    }
  >>
}
@end lilypond

El espaciado es defectuoso porque las notas regularmente espaciadas
del pentagrama inferior no se amplían de manera uniforme.  Los grabados
clásicos incluyen muy pocos tresillos complejos y así las reglas del
grabado clásico pueden generar este tipo de resultado.  El
establecimiento de @code{proportionalNotationDuration} lo
soluciona.

@lilypond[quote,verbatim,ragged-right]
\score {
  <<
    \new RhythmicStaff {
      c'2
      c'16 c'16 c'16 c'16
      \times 4/5 {
        c'16 c'16 c'16 c'16 c'16
      }
    }
    \new RhythmicStaff {
      \times 8/9 {
        c'8 c'8 c'8 c'8 c'8 c'8 c'8 c'8 c'8
      }
    }
  >>
  \layout {
    \context {
      \Score
      proportionalNotationDuration = #(ly:make-moment 1 20)
    }
  }
 }
@end lilypond


Pero si observamos con mucho cuidado podremos ver que las notas de la
segunda mitad del 9-illo están espaciadas de forma ligeramente más
ancha que las de la primera mitad del 9-illo.  Para asegurar una
ampliación uniforme, activamos @code{uniform-stretching}, que es una
propiedad de @code{SpacingSpanner}.

@lilypond[quote,verbatim,ragged-right]
\score {
  <<
    \new RhythmicStaff {
      c'2
      c'16 c'16 c'16 c'16
      \times 4/5 {
        c'16 c'16 c'16 c'16 c'16
      }
    }
    \new RhythmicStaff {
      \times 8/9 {
        c'8 c'8 c'8 c'8 c'8 c'8 c'8 c'8 c'8
      }
    }
  >>
  \layout {
    \context {
      \Score
      proportionalNotationDuration = #(ly:make-moment 1 20)
      \override SpacingSpanner #'uniform-stretching = ##t
    }
  }
}
@end lilypond

Nuestro ejemplo de dos pentagramas ahora está espaciado exactamente,
nuestras relaciones rítmicas son visualmente claras, y podemos incluir
una línea de tiempo graduada o un gráfico, si queremos.

Observe que el paquete de notación proporcional de LilyPond espera que
todas las partituras proporcionales establezcan el atributo
@code{uniform-stretching} de @code{SpacingSpanner} al valor ##t.  El
establecimiento de @code{proportionalNotationDuration} sin ajustar
también el atributo @code{uniform-stretching} de @code{SpacingSpanner}
al valor ##t causará, por ejemplo, que los desplazamientos
(@code{skips}) consuman una cantidad de espacio horizontal incorrecta.

El @code{SpacingSpanner} es un grob abstracto que reside en el
contexto de @code{Score}. Como con nuestros ajustes de
@code{proportionalNotationDuration}, las sobreescrituras al
@code{SpacingSpanner} sólo pueden ocurrir en uno de estos tres lugares
dentro del archivo de entrada: en el bloque @code{\with}, en el bloque
@code{\context} o directamente dentro de la escritura de notas.

De manera predeterminada, sólo hay un @code{SpacingSpanner} por
@code{Score}.  Esto supone que, por omisión, @code{uniform-stretching}
está activado para la partitura completa o desactivado para la
partitura completa.  Sin embargo, podemos sobreescribir este
comportamiento y activar distintas posibilidades de espaciado en
distintos lugares de la partitura.  Lo hacemos con la instrucción
@code{\newSpacingSection}.  Consulte @ref{Área de espaciado nueva} para más
información.

A continuación examinamos los efectos del grabador
@code{Separating_line_group_engraver} y veremos por qué las partituras
proporcionales con frecuencia eliminan este grabador.  El ejemplo
siguiente muestra que hay una pequeña cantidad de espacio
@qq{preparatorio} justo antes de la primera nota de cada sistema.

@lilypond[quote,verbatim,ragged-right]
\paper {
  indent = #0
}

\new Staff {
  c'1
  \break
  c'1
}
@end lilypond


Esta cantidad de espacio preparatorio es la misma ya sea después de
una indicación de compás, una armadura o una clave.  El grabador
@code{Separating_line_group_engraver} es responsable de este espacio.
La eliminación de @code{Separating_line_group_engraver} reduce este
espacio a cero.

@lilypond[quote,verbatim,ragged-right]
\paper {
  indent = #0
}

\new Staff \with {
  \remove Separating_line_group_engraver
} {
  c'1
  \break
  c'1
}
@end lilypond

Los elementos no musicales como la indicación de compás, la armadura,
la clave y las alteraciones son problemáticos en notación
proporcional.  Ninguno de estos elementos tiene duración rítmica.
Pero todos ellos consumen espacio horizontal.  Las distintas
partituras proporcionales abordan este problema de distinta manera.

Sería posible evitar los problemas de espaciado con las armaduras,
simplemente evitando tenerlas.  Esta es una opción válida pues casi
todas las partituras proporcionales son música contemporánea.  Lo
mismo puede valer para las indicaciones de compás, especialmente para
las partituras que incluyen una línea de tiempo graduada u otro
gráfico.  Pero estas partituras son excepcionales y casi todas las
partituras proporcionales incluyen al menos unas pocas indicaciones de
compás.  Las claves y las alteraciones son aún más esenciales.

Así pues ¿qué estrategias existen para el espaciado de los elementos
no musicales en un contexto proporcional?  Una buena opción es la
propiedad @code{strict-note-spacing} de @code{SpacingSpanner}.
Compare las dos partituras siguientes:

@lilypond[quote,verbatim,ragged-right]
\new Staff {
  \set Score.proportionalNotationDuration = #(ly:make-moment 1 16)
  c''8
  c''8
  c''8
  \clef alto
  d'8
  d'2
}

\new Staff {
  \set Score.proportionalNotationDuration = #(ly:make-moment 1 16)
  \override Score.SpacingSpanner #'strict-note-spacing = ##t
  c''8
  c''8
  c''8
  \clef alto
  d'8
  d'2
}
@end lilypond

Las dos partituras son proporcionales, pero el espaciado de la
primera es muy suelto a causa del cambio de clave. Sin embargo, el
espaciado de la segunda partitura se mantiene estricto, porque
@code{strict-note-spacing} está activado.  La activación de
@code{strict-note-spacing} hace que el ancho de las indicaciones de
compás, armaduras, cambios de clave y alteraciones no tomen parte en
el algoritmo de espaciado.

Además de los ajustes dados aquí, hay otros que aparecen con
frecuencia en las partituras proporcionales.  Entre ellos están:

@itemize
@item @code{\override SpacingSpanner #'strict-grace-spacing = ##t}
@item @code{tupletFullLength = ##t}
@item @code{\override Beam #'breakable = ##t}
@item @code{\override Glissando #'breakable = ##t}
@item @code{\override TextSpanner #'breakable = ##t}
@item @code{\remove Forbid_line_break_engraver in the Voice context}
@end itemize

Estos ajustes dan a las notas de adorno un espaciado estricto,
extienden los corchetes de grupo especial para que marquen tanto los
puntos de comienzo como de final, y permiten que los elementos de
extensión se dividan entre los sistemas y las páginas.  Consulte las
partes respectivas del manual para ver estos ajustes relacionados.


@seealso
Referencia de la notación:
@ref{Área de espaciado nueva}.

Fragmentos de código:
@rlsr{Spacing}.


@node Encajar la música en menos páginas
@section Encajar la música en menos páginas
@translationof Fitting music onto fewer pages

En ocasiones, podemos terminar con uno o dos pentagramas en una
segunda página (o tercera, o cuarta...).  Es fastidioso, especialmente
cuando vemos que las páginas anteriores parecen tener espacio de
sobra.

Al investigar los problemas de disposición, una herramienta de valor
incalculable es @code{annotate-spacing}.  Esta instrucción imprime los
valores de un cierto número de variables de espaciado; para ver más
detalles consulte la sección siguiente, @ref{Mostrar el espaciado}.

@menu
* Mostrar el espaciado::
* Cambiar el espaciado::
@end menu


@node Mostrar el espaciado
@subsection Mostrar el espaciado
@translationof Displaying spacing

@cindex espaciado, presentación del
@funindex annotate-spacing

Para presentar gráficamente las dimensiones de las variables de
disposición vertical que pueden verse alteradas por el formato de la
página, establezca @code{annotate-spacing} en el bloque @code{\paper}:

@c need to have \book{} otherwise we get the separate systems. -hwn
@lilypond[verbatim,quote]
#(set-default-paper-size "a6" 'landscape)
\book {
  \score { { c4 } }
  \paper { annotate-spacing = ##t }
}
@end lilypond

@noindent
Todas las dimensiones de disposición se muestran en espacios de
pentagrama, independientemente de las unidades especificadas en los
bloques @code{\paper} o @code{\layout}. En el ejemplo anterior,
@code{paper-height} tiene un valor de 59.75 @code{staff-spaces}
(espacios de pentagrama), y el @code{staff-size} (tamaño del
pentagrama) es de 20 puntos, el valor predeterminado. Observe que:

@multitable {1 staff-space} {staff-size)/4 * (25.4/72.27) mm}

@item 1 punto
@tab = (25.4/72.27) mm

@item 1 staff-space
@tab = (@code{staff-size})/4 pts
@item
@tab = (@code{staff-size})/4 * (25.4/72.27) mm

@end multitable

@noindent
En este caso, un @code{staff-space} equivale aproximadamente a
1.757mm.  Así, la medida @code{paper-height} de 59.75
@code{staff-spaces} equivale a 105 milímetros, la altura de una hoja
@code{a6} en orientación apaisada.  Las parejas (@var{a},@var{b}) son
intervalos, donde @var{a} es el límite inferior y @var{b} es el límite
superior del intervalo.


@seealso
Referencia de la notación:
@ref{Establecer el tamaño del pentagrama}.

Fragmentos de código:
@rlsr{Spacing}.


@node Cambiar el espaciado
@subsection Cambiar el espaciado
@translationof Changing spacing

La salida de @code{annotate-spacing} revela las dimensiones verticales
con gran detalle.  Para ver más detalles acerca de la modificación de
los márgenes y otras variables de diseño de la página, consulte
@ref{Formateo de las páginas}.

Aparte de los márgenes, hay algunas otras opciones para ahorrar espacio:

@itemize
@item
Forzar los sistemas para que se junten lo más posible entre sí (de
forma que quepan la mayor cantidad de ellos en la página) y al mismo
tiempo estén espaciados de forma que no exista un espacio vacío en la
parte baja del papel.

@example
\paper @{
  system-system-spacing = #'((padding . 0) (space . 0.1))
  ragged-last-bottom = ##f
  ragged-bottom = ##f
@}
@end example

@item
Forzar el número de sistemas.  Puede ser de utilidad de dos formas.
Si tan sólo se establece un valor, incluso el mismo valor que el
número de sistemas que se están trazando de forma predeterminada, ello
ocasionará a veces que se traten de introducir más sistemas en cada
página, pues en este caso se omite un paso en que se produce una
estimación, dando así un encaje mejor en cada página.  Asimismo, el
forzar una reducción neta en el número de sistemas puede producir el
ahorro de una página adicional.  Por ejemplo, si la disposición
predeterminada tiene 11 sistemas, la asignación siguiente fuerza una
disposición con 10 sistemas.

@example
\paper @{
  system-count = #10
@}
@end example

@item
Evitar (o reducir en número) los objetos que aumentan el tamaño
vertical de un sistema.  Por ejemplo, las repeticiones de primera y
segunda vez (o repeticiones con finales alternativos) necesitan
espacio adicional.  Si estas repeticiones se reparten a lo largo de
dos sistemas, ocupan más espacio que un sistema con las casillas de
repetición y otro sistema sin ellas.  Por ejemplo, las indicaciones
dinámicas que se @q{salen} de un sistema se pueden acercar al
pentagrama:

@lilypond[verbatim,quote,relative=1]
e4 c g\f c
e4 c g-\tweak #'X-offset #-2.7 -\tweak #'Y-offset #2.5 \f c
@end lilypond

@item
Alterar el espaciado horizontal por medio de @code{SpacingSpanner}.
Para ver más detalles, consulte @ref{Cambiar el espaciado horizontal}.  El
ejemplo siguiente ilustra el espaciado predeterminado:

@lilypond[verbatim,quote]
\score {
  \relative c'' {
    g4 e e2 |
    f4 d d2 |
    c4 d e f |
    g4 g g2 |
    g4 e e2 |
  }
}
@end lilypond

@noindent
El ejemplo siguiente modifica @code{common-shortest-duration} de un
valor de @code{1/4} (negra) a @code{1/2} (blanca).  La negra es la
nota más común y la más breve del ejemplo, por lo que al agrandar esta
duración se produce un efecto de @q{apretujamiento}:

@lilypond[verbatim,quote]
\score {
  \relative c'' {
    g4 e e2 |
    f4 d d2 |
    c4 d e f |
    g4 g g2 |
    g4 e e2 |
  }
  \layout {
    \context {
      \Score
      \override SpacingSpanner
        #'common-shortest-duration = #(ly:make-moment 1 2)
    }
  }
}
@end lilypond

@noindent
La propiedad @code{common-shortest-duration} no se puede modificar de
manera dinámica, por lo que se debe situar siempre dentro de un
bloque @code{\context} de forma que se aplique a la partitura
completa.

@end itemize


@seealso
Referencia de la notación:
@ref{Formateo de las páginas},
@ref{Cambiar el espaciado horizontal}.

Fragmentos de código:
@rlsr{Spacing}.
